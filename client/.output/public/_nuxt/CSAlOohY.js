import{_ as j,a as A,b as B}from"./D9kwdG5X.js";import{_ as I}from"./B9JXikVy.js";import{o as g,s as _,_ as N,a as F}from"./CcMNF4Xq.js";import{aR as z,J as h,f as C,aK as D,aF as P,a3 as T,h as E,o as G,w as r,b as t,a as u,i as o,s as J,d as x}from"#entry";import{_ as K}from"./BBjs8tJp.js";import{u as M}from"./D7nSowku.js";import"./DCPclr-j.js";import"./CAHQj7nW.js";import"./GVlOEoCD.js";import"./CmeGZb1j.js";const m=M(),R=z("userStore",{state:()=>({isLoading:!1,items:null,status:null,error:null}),actions:{async fetchProfile(){const{$axios:d}=h();this.isLoading=!0,this.status=null,this.error=null;try{const s=await d.get("/users/current",{headers:{Authorization:`${m.type} ${m.token}`}});this.items=s.data.data,this.status=s.status}catch(s){this.status=s.response?.status||500,this.error=s.response?.data?.errors||"Internal server error. please try agan later."}finally{this.isLoading=!1}},async updateProfile(d){const{$axios:s}=h();this.isLoading=!0,this.status=null,this.error=null;try{const a=await s.put("/users/profile",d,{headers:{Authorization:`${m.type} ${m.token}`}});this.items=a.data.data,this.status=a.status,console.log(a.data)}catch(a){this.status=a.response?.status||500,this.error=a.response?.data?.errors||"Internal server error. please try agan later."}finally{this.isLoading=!1}},async updatePassword(d){const{$axios:s}=h();this.isLoading=!0,this.status=null,this.error=null;try{const a=await s.put("/users/password",d,{headers:{Authorization:`${m.type} ${m.token}`}});this.status=a.status}catch(a){this.status=a.response?.status||500,this.error=a.response?.data?.errors||"Internal server error. please try agan later."}finally{this.isLoading=!1}}}}),q={class:"container mx-auto px-4 py-8"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},O={class:"flex justify-end"},Q={class:"flex justify-end"},ns=C({__name:"profile",setup(d){const s=R(),a=D(),k=g({username:_().min(1,"Username wajib diisi"),email:_().email("Email tidak valid")}),U=g({current_password:_().min(1,"Password lama wajib diisi"),new_password:_().min(6,"Password baru minimal 6 karakter")}),n=P({username:"",email:""}),i=P({current_password:"",new_password:""});T(async()=>{await s.fetchProfile(),n.username=s.items.username,n.email=s.items.email});async function V(p){await s.updateProfile(p.data),s.status===200?a.add({title:"Berhasil",description:"Profil berhasil diperbarui.",color:"success"}):a.add({title:"Gagal",description:s.error||"Terjadi kesalahan saat memperbarui profil.",color:"error"})}async function $(p){await s.updatePassword(p.data),s.status===200?(a.add({title:"Berhasil",description:"Password berhasil diperbarui.",color:"success"}),i.current_password="",i.new_password=""):a.add({title:"Gagal",description:"Password lama salah atau terjadi kesalahan.",color:"error"})}return(p,e)=>{const S=A,c=I,f=F,w=J,b=N,y=K,v=j,L=B;return G(),E(L,{class:"min-h-screen bg-gray-50 dark:bg-gray-900"},{default:r(()=>[t(v,null,{header:r(()=>[t(S,{title:"Profil"})]),body:r(()=>[u("section",q,[u("div",H,[t(y,{class:"shadow-md rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950"},{header:r(()=>[...e[4]||(e[4]=[u("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100"}," Informasi Profil ",-1)])]),default:r(()=>[t(b,{schema:o(k),state:o(n),onSubmit:V,class:"space-y-5"},{default:r(()=>[t(f,{label:"Username",name:"username"},{default:r(()=>[t(c,{modelValue:o(n).username,"onUpdate:modelValue":e[0]||(e[0]=l=>o(n).username=l),class:"w-full"},null,8,["modelValue"])]),_:1}),t(f,{label:"Email",name:"email"},{default:r(()=>[t(c,{modelValue:o(n).email,"onUpdate:modelValue":e[1]||(e[1]=l=>o(n).email=l),class:"w-full"},null,8,["modelValue"])]),_:1}),u("div",O,[t(w,{type:"submit",color:"primary"},{default:r(()=>[...e[5]||(e[5]=[x("Perbarui",-1)])]),_:1})])]),_:1},8,["schema","state"])]),_:1}),t(y,{class:"shadow-md rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950"},{header:r(()=>[...e[6]||(e[6]=[u("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100"}," Ubah Password ",-1)])]),default:r(()=>[t(b,{schema:o(U),state:o(i),onSubmit:$,class:"space-y-5"},{default:r(()=>[t(f,{label:"Password Lama",name:"oldPassword"},{default:r(()=>[t(c,{type:"password",modelValue:o(i).current_password,"onUpdate:modelValue":e[2]||(e[2]=l=>o(i).current_password=l),class:"w-full"},null,8,["modelValue"])]),_:1}),t(f,{label:"Password Baru",name:"newPassword"},{default:r(()=>[t(c,{type:"password",modelValue:o(i).new_password,"onUpdate:modelValue":e[3]||(e[3]=l=>o(i).new_password=l),class:"w-full"},null,8,["modelValue"])]),_:1}),u("div",Q,[t(w,{type:"submit",color:"primary"},{default:r(()=>[...e[7]||(e[7]=[x("Ubah Password",-1)])]),_:1})])]),_:1},8,["schema","state"])]),_:1})])])]),_:1})]),_:1})}}});export{ns as default};
