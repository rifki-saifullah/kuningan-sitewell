import{aR as n,J as a,R as o}from"#entry";const h=300*1e3,l=n("authStore",{state:()=>({isLoading:!1,items:null,status:null,error:null,token:null,type:null,expiresAt:null,isAuthenticated:!1}),actions:{setup(){this.isLoading=!0,this.status=null,this.error=null},setSession(e,s,t){sessionStorage.setItem("token",e),sessionStorage.setItem("type",s),sessionStorage.setItem("expiresAt",String(Date.now()+t*1e3))},setAuthState(e,s,t){this.token=e,this.type=s,this.expiresAt=Date.now()+t*1e3,this.isAuthenticated=!0},setAuthStateFromStorage(e,s,t){this.token=e,this.type=s,this.expiresAt=t,this.isAuthenticated=!0},clearSession(){sessionStorage.removeItem("token"),sessionStorage.removeItem("type"),sessionStorage.removeItem("expiresAt")},clearAuthState(){this.token=null,this.type=null,this.expiresAt=null,this.isAuthenticated=!1},clearState(){this.items=null,this.status=null,this.error=null,this.token=null,this.type=null,this.expiresAt=null,this.isAuthenticated=!1},validateSession(){if(!this.token||!this.type||!this.expiresAt){const e=sessionStorage.getItem("token"),s=sessionStorage.getItem("type"),t=Number(sessionStorage.getItem("expiresAt"));if(!e||!s||!t)return!1;if(this.setAuthState(e,s,t),Date.now()>this.expiresAt)return this.clearSession(),this.clearState(),!1}return!0},async login(e){const{$axios:s}=a(),t=o();this.setup();try{const i=await s.post("/auths/login",e),r=i.data.data;this.status=i.status,this.setSession(r.token,r.type,r.expires_in),this.setAuthState(r.token,r.type,r.expires_in),t.push("/admins")}catch(i){this.status=i.response?.status||500,this.error=i.response?.data?.errors||"Internal server error. Please try again later."}finally{this.isLoading=!1}},async check(){const{$axios:e}=a(),s=o();this.setup(),this.validateSession()||s.push("/login");try{const t=await e.post("/auths/check",{},{headers:{Authorization:`${this.type} ${this.token}`}});this.status=t.status,this.expiresAt-Date.now()<h&&await this.refresh()}catch(t){this.status=t.response?.status||500,this.error=t.response?.data?.errors||"Internal server error. Please try again later.",this.clearSession(),this.clearState(),s.push("/login")}finally{this.isLoading=!1}return!1},async refresh(){const{$axios:e}=a();this.setup();try{const s=await e.post("/auths/refresh",{},{headers:{Authorization:`${this.type} ${this.token}`}});this.status=s.status;const t=s.data.data;return this.setSession(t.token,t.type,t.expires_in),this.setAuthState(t.token,t.type,t.expires_in),!0}catch(s){return this.status=s.response?.status||500,this.error=s.response?.data?.errors||"Internal server error. Please try again later.",!1}finally{this.isLoading=!1}},async logout(){const{$axios:e}=a(),s=o();this.setup();try{const t=await e.post("/auths/logout",{},{headers:{Authorization:`${this.type} ${this.token}`}});this.status=t.status}catch(t){this.status=t.response?.status||500,this.error=t.response?.data?.errors||"Internal server error. Please try again later."}finally{this.isLoading=!1,this.clearSession(),this.clearAuthState(),s.push("/login")}}}});export{l as u};
