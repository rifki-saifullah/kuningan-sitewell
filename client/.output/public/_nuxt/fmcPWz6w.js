import{_ as N,a as I,b as M}from"./Bhg-rSlI.js";import{_ as z}from"./B-KQvTno.js";import{o as x,s as _,_ as C,a as D}from"./B2GWIpRm.js";import{aZ as F,Z as g,f as G,aS as T,aN as S,B as U,G as E,h as Z,o as q,w as r,b as e,a as m,i as o,s as H,d as V}from"#entry";import{_ as J}from"./BBjs8tJp.js";import{u as b}from"./QHQVrWkE.js";import"./B38Xgcxb.js";import"./Cj6fZvd0.js";import"./CrmXzHFT.js";import"./Cu7TN0iE.js";const K=F("userStore",{state:()=>({isLoading:!1,items:null,status:null,error:null}),persist:{storage:sessionStorage},actions:{async fetchProfile(){const{$axios:u}=g(),t=b();this.isLoading=!0,this.status=null,this.error=null;try{const a=await u.get("/users/current",{headers:{Authorization:`${t.type} ${t.token}`}});this.items=a.data.data,this.status=a.status}catch(a){this.status=a.response?.status||500,this.error=a.response?.data?.errors||"Internal server error. please try agan later."}finally{this.isLoading=!1}},async updateProfile(u){const{$axios:t}=g(),a=b();this.isLoading=!0,this.status=null,this.error=null;try{const l=await t.put("/users/profile",u,{headers:{Authorization:`${a.type} ${a.token}`}});this.items=l.data.data,this.status=l.status,console.log(l.data)}catch(l){this.status=l.response?.status||500,this.error=l.response?.data?.errors||"Internal server error. please try agan later."}finally{this.isLoading=!1}},async updatePassword(u){const{$axios:t}=g(),a=b();this.isLoading=!0,this.status=null,this.error=null;try{const l=await t.put("/users/password",u,{headers:{Authorization:`${a.type} ${a.token}`}});this.status=l.status}catch(l){this.status=l.response?.status||500,this.error=l.response?.data?.errors||"Internal server error. please try agan later."}finally{this.isLoading=!1}}}}),O={class:"container mx-auto px-4 py-8"},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},R={class:"flex justify-end"},W={class:"flex justify-end"},ia=G({__name:"profile",setup(u){const t=K(),a=T(),l=x({username:_().min(1,"Username wajib diisi"),email:_().email("Email tidak valid")}),$=x({current_password:_().min(1,"Password lama wajib diisi"),new_password:_().min(6,"Password baru minimal 6 karakter")}),n=S({username:"",email:""}),i=S({current_password:"",new_password:""}),h=U(!1),w=U(!1);E(async()=>{await t.fetchProfile(),n.username=t.items.username,n.email=t.items.email});async function v(p){h.value=!0,await t.updateProfile(p.data),t.status===200?a.add({title:"Berhasil",description:"Profil berhasil diperbarui.",color:"success"}):a.add({title:"Gagal",description:t.error||"Terjadi kesalahan saat memperbarui profil.",color:"error"}),h.value=!1}async function B(p){w.value=!0,await t.updatePassword(p.data),t.status===200?(a.add({title:"Berhasil",description:"Password berhasil diperbarui.",color:"success"}),i.current_password="",i.new_password=""):a.add({title:"Gagal",description:"Password lama salah atau terjadi kesalahan.",color:"error"}),w.value=!1}return(p,s)=>{const L=I,c=z,f=D,y=H,k=C,P=J,j=N,A=M;return q(),Z(A,{class:"min-h-screen bg-gray-50 dark:bg-gray-900"},{default:r(()=>[e(j,null,{header:r(()=>[e(L,{title:"Profil"})]),body:r(()=>[m("section",O,[m("div",Q,[e(P,{class:"shadow-md rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950"},{header:r(()=>[...s[4]||(s[4]=[m("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100"}," Informasi Profil ",-1)])]),default:r(()=>[e(k,{schema:o(l),state:o(n),onSubmit:v,class:"space-y-5",autocomplete:"off"},{default:r(()=>[e(f,{label:"Username",name:"username"},{default:r(()=>[e(c,{modelValue:o(n).username,"onUpdate:modelValue":s[0]||(s[0]=d=>o(n).username=d),class:"w-full",placeholder:"Masukkan username"},null,8,["modelValue"])]),_:1}),e(f,{label:"Email",name:"email"},{default:r(()=>[e(c,{modelValue:o(n).email,"onUpdate:modelValue":s[1]||(s[1]=d=>o(n).email=d),class:"w-full",placeholder:"Masukkan email aktif"},null,8,["modelValue"])]),_:1}),m("div",R,[e(y,{loading:o(h),type:"submit",color:"primary"},{default:r(()=>[...s[5]||(s[5]=[V(" Perbarui ",-1)])]),_:1},8,["loading"])])]),_:1},8,["schema","state"])]),_:1}),e(P,{class:"shadow-md rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950"},{header:r(()=>[...s[6]||(s[6]=[m("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100"}," Ubah Password ",-1)])]),default:r(()=>[e(k,{schema:o($),state:o(i),onSubmit:B,class:"space-y-5",autocomplete:"off"},{default:r(()=>[e(f,{label:"Password Lama",name:"current_password"},{default:r(()=>[e(c,{type:"password",modelValue:o(i).current_password,"onUpdate:modelValue":s[2]||(s[2]=d=>o(i).current_password=d),autocomplete:"new-password",placeholder:"Masukkan password lama",class:"w-full"},null,8,["modelValue"])]),_:1}),e(f,{label:"Password Baru",name:"new_password"},{default:r(()=>[e(c,{type:"password",modelValue:o(i).new_password,"onUpdate:modelValue":s[3]||(s[3]=d=>o(i).new_password=d),autocomplete:"new-password",placeholder:"Masukkan password baru",class:"w-full"},null,8,["modelValue"])]),_:1}),m("div",W,[e(y,{loading:o(w),type:"submit",color:"primary"},{default:r(()=>[...s[7]||(s[7]=[V(" Ubah Password ",-1)])]),_:1},8,["loading"])])]),_:1},8,["schema","state"])]),_:1})])])]),_:1})]),_:1})}}});export{ia as default};
